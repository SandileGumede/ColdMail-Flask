<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ColdMail - Email Analysis{% endblock %}</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/my_simple_logo.png">
    <link rel="shortcut icon" type="image/png" href="/static/my_simple_logo.png">
    <link rel="apple-touch-icon" href="/static/my_simple_logo.png">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/dark-mode.css">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="/static/my_simple_logo.png" alt="ColdMail Logo" class="nav-logo">
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link {% if request.endpoint == 'index' %}active{% endif %}">Home</a>
                <a href="/faq" class="nav-link {% if request.endpoint == 'faq' %}active{% endif %}">FAQ</a>
                <a href="/contact" class="nav-link {% if request.endpoint == 'contact' %}active{% endif %}">Contact</a>
                {% if current_user.is_authenticated %}
                    <span class="nav-link" style="color:#4a90e2;">{{ current_user.user_name or current_user.email }}</span>
                    <form action="/logout" method="POST" style="display:inline; margin:0; padding:0;" id="logout-form">
                        <button type="submit" class="nav-link" id="logout-button" style="background:none; border:none; cursor:pointer; font-size:inherit; font-weight:inherit; padding:8px 16px; border-radius:20px; color:inherit; text-decoration:none; font-family:inherit;">Logout</button>
                    </form>
                {% else %}
                    <a href="/login" class="nav-link {% if request.endpoint == 'login' %}active{% endif %}">Login</a>
                    <a href="/signup" class="nav-link {% if request.endpoint == 'signup' %}active{% endif %}">Sign Up</a>
                {% endif %}
                <!-- Theme toggle menu item will be added here by dark-mode.js -->
            </div>
            <div class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    {% block content %}{% endblock %}

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="/faq">FAQ</a>
                <a href="/privacy">Privacy Policy</a>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 ColdMail. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/static/dark-mode.js"></script>
    <script>
        // Mobile navigation toggle
        document.getElementById('navToggle').addEventListener('click', function() {
            document.querySelector('.nav-links').classList.toggle('active');
            this.classList.toggle('active');
        });
        
        // #region agent log - Logout debugging
        document.addEventListener('DOMContentLoaded', function() {
            const logoutForm = document.getElementById('logout-form');
            const logoutButton = document.getElementById('logout-button');
            
            if (logoutForm && logoutButton) {
                // Hypothesis A: Button clickability
                logoutButton.addEventListener('click', function(e) {
                    fetch('http://127.0.0.1:7242/ingest/4ec28f9f-7af4-4ae5-bda3-64229dd29bcb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'base.html:button-click',message:'Logout button clicked',data:{eventType:e.type,buttonId:logoutButton.id},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                });
                
                // Hypothesis B: Form submission
                logoutForm.addEventListener('submit', function(e) {
                    fetch('http://127.0.0.1:7242/ingest/4ec28f9f-7af4-4ae5-bda3-64229dd29bcb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'base.html:form-submit',message:'Logout form submitting',data:{action:logoutForm.action,method:logoutForm.method,defaultPrevented:e.defaultPrevented},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                });
                
                // Check if button is visible and clickable
                const rect = logoutButton.getBoundingClientRect();
                const styles = window.getComputedStyle(logoutButton);
                fetch('http://127.0.0.1:7242/ingest/4ec28f9f-7af4-4ae5-bda3-64229dd29bcb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'base.html:button-check',message:'Logout button state check',data:{visible:rect.width>0&&rect.height>0,pointerEvents:styles.pointerEvents,zIndex:styles.zIndex,display:styles.display},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            } else {
                fetch('http://127.0.0.1:7242/ingest/4ec28f9f-7af4-4ae5-bda3-64229dd29bcb',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'base.html:init',message:'Logout form/button not found',data:{formFound:!!logoutForm,buttonFound:!!logoutButton},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            }
        });
        // #endregion
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
